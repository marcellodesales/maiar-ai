name: ♻️ CI Workflow
run-name: ♻️ CI Workflow for PR ${{ github.ref_name }} commit ${{ github.sha }} by @${{ github.actor }}
on:
  pull_request:
    branches:
      - "main"
      - "develop"
      - "feature/**"
      - "bugfix/**"
      - "hotfix/**"

env:
  CI: ${{ vars.CI }}
  HUSKY: ${{ vars.HUSKY }}

jobs:
  commit-lint:
    name: 🧹 Commit Lint
    runs-on: ubuntu-latest
    steps:
      - name: 🛒 Checkout
        uses: actions/checkout@v4

      - uses: ./.github/actions/setup-node-pnpm-install

      - name: 🧹 Lint Commits
        uses: wagoid/commitlint-github-action@v6
        with:
          configFile: .commitlintrc.ts
          helpURL: https://github.com/conventional-changelog/commitlint/#what-is-commitlint

  build:
    name: 🧱 Build Packages
    runs-on: ubuntu-latest
    steps:
      - name: 🛒 Checkout
        uses: actions/checkout@v4

      - uses: ./.github/actions/setup-node-pnpm-install

      # NOTE: Must build packages before linting due to official plugins dependency on @maiar-ai/core package - Linting will fail upfront otherwise
      - name: 🧱 Build Packages
        run: pnpm run build

  code-lint:
    name: 🧹 Lint Codebase
    needs: [build]
    runs-on: ubuntu-latest
    steps:
      - name: 🛒 Checkout
        uses: actions/checkout@v4

      - uses: ./.github/actions/setup-node-pnpm-install

      # NOTE: Must build packages before linting due to official plugins dependency on @maiar-ai/core package - Linting will fail upfront otherwise
      - name: 🧱 Build Packages
        run: pnpm run build

      - name: 🧹 Lint TypeScript
        run: pnpm run lint

      - name: 🧹 Lint ESLint
        run: pnpm run eslint
